#!/usr/bin/env node

/**
 * üîç FERRAMENTA DE DIAGN√ìSTICO COMPLETA - PORTAL X BRASIL
 * 
 * PARTE 01 - PROBLEMAS IDENTIFICADOS:
 * ‚ùå Rotas n√£o funcionando (/login, /register, /admin)
 * ‚ùå Verifica√ß√£o de idade repetindo entre p√°ginas
 * ‚ùå Build OK mas p√°ginas n√£o exibindo
 * ‚ùå Navega√ß√£o quebrada
 * 
 * Execute: node diagnose-portal.mjs
 */

import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// Cores para terminal
const colors = {
  red: '\x1b[31m',
  green: '\x1b[32m',
  yellow: '\x1b[33m',
  blue: '\x1b[34m',
  magenta: '\x1b[35m',
  cyan: '\x1b[36m',
  white: '\x1b[37m',
  reset: '\x1b[0m',
  bright: '\x1b[1m',
  bg: {
    red: '\x1b[41m',
    green: '\x1b[42m',
    yellow: '\x1b[43m'
  }
};

class PortalDiagnostic {
  constructor() {
    this.projectRoot = process.cwd();
    this.issues = [];
    this.criticalIssues = [];
    this.routeProblems = [];
    this.ageVerificationIssues = [];
    this.missingFiles = [];
    this.configProblems = [];
    this.buildProblems = [];
  }

  // ==================== UTILIT√ÅRIOS ====================
  
  log(message, color = 'white') {
    console.log(`${colors[color]}${message}${colors.reset}`);
  }

  logHeader(title) {
    console.log(`\n${colors.cyan}${colors.bright}${'='.repeat(60)}${colors.reset}`);
    console.log(`${colors.cyan}${colors.bright}üîç ${title}${colors.reset}`);
    console.log(`${colors.cyan}${colors.bright}${'='.repeat(60)}${colors.reset}\n`);
  }

  addIssue(category, severity, description, file, solution, code = null) {
    const issue = {
      category,
      severity,
      description,
      file,
      solution,
      code,
      timestamp: new Date().toISOString()
    };
    
    this.issues.push(issue);
    if (severity === 'CR√çTICO') {
      this.criticalIssues.push(issue);
    }

    if (category.includes('ROTA')) {
      this.routeProblems.push(issue);
    }
    if (category.includes('IDADE')) {
      this.ageVerificationIssues.push(issue);
    }
    if (category.includes('BUILD')) {
      this.buildProblems.push(issue);
    }
  }

  fileExists(filePath) {
    const fullPath = path.join(this.projectRoot, filePath);
    return fs.existsSync(fullPath);
  }

  readFile(filePath) {
    try {
      const fullPath = path.join(this.projectRoot, filePath);
      return fs.readFileSync(fullPath, 'utf8');
    } catch (error) {
      return null;
    }
  }

  // ==================== DIAGN√ìSTICOS PRINCIPAIS ====================

  // 1. VERIFICAR ESTRUTURA DE ARQUIVOS
  async checkFileStructure() {
    this.logHeader('VERIFICANDO ESTRUTURA DE ARQUIVOS');

    const requiredFiles = [
      // Arquivos principais
      'src/App.jsx',
      'src/main.jsx', 
      'vite.config.js',
      'package.json',
      
      // P√°ginas obrigat√≥rias (que n√£o est√£o funcionando)
      'src/pages/Home.jsx',
      'src/pages/Login.jsx', 
      'src/pages/Register.jsx',
      'src/pages/Admin.jsx',
      'src/pages/Dashboard.jsx',
      'src/pages/Ranking.jsx',
      'src/pages/Category.jsx',
      'src/pages/State.jsx',
      'src/pages/Novidades.jsx',
      'src/pages/Populares.jsx', 
      'src/pages/Premium.jsx',
      
      // Componentes cr√≠ticos
      'src/components/AgeVerification.jsx',
      'src/components/Header.jsx',
      'src/components/LoadingScreen.jsx',
      'src/components/AccessCode.jsx',
      
      // Context e hooks
      'src/context/AuthContext.jsx',
      'src/hooks/useAuth.js',
      
      // Services
      'src/services/api.js',
      'src/services/auth.js'
    ];

    let missingCount = 0;
    
    for (const file of requiredFiles) {
      if (!this.fileExists(file)) {
        missingCount++;
        this.missingFiles.push(file);
        this.addIssue(
          'ARQUIVO_FALTANDO',
          'CR√çTICO',
          `Arquivo obrigat√≥rio n√£o encontrado: ${file}`,
          file,
          `Criar o arquivo ${file} - isso pode estar causando as rotas n√£o funcionarem`
        );
        this.log(`‚ùå FALTANDO: ${file}`, 'red');
      } else {
        this.log(`‚úÖ OK: ${file}`, 'green');
      }
    }

    if (missingCount === 0) {
      this.log('\nüéâ TODOS OS ARQUIVOS OBRIGAT√ìRIOS ENCONTRADOS!', 'green');
    } else {
      this.log(`\n‚ö†Ô∏è  ${missingCount} ARQUIVOS FALTANDO - ISSO PODE ESTAR QUEBRANDO AS ROTAS!`, 'yellow');
    }
  }

  // 2. ANALISAR CONFIGURA√á√ÉO DE ROTAS
  async checkRouteConfiguration() {
    this.logHeader('ANALISANDO CONFIGURA√á√ÉO DE ROTAS NO APP.JSX');

    const appContent = this.readFile('src/App.jsx');
    if (!appContent) {
      this.addIssue(
        'ROTA_CR√çTICO',
        'CR√çTICO',
        'App.jsx n√£o encontrado - Sistema de rotas n√£o vai funcionar',
        'src/App.jsx',
        'Criar App.jsx com todas as rotas configuradas corretamente'
      );
      this.log('‚ùå App.jsx N√ÉO ENCONTRADO - ROTAS N√ÉO V√ÉO FUNCIONAR!', 'red');
      return;
    }

    // Verificar rotas espec√≠ficas que n√£o est√£o funcionando
    const routesToCheck = [
      { path: '/login', component: 'Login', protected: false },
      { path: '/register', component: 'Register', protected: false },
      { path: '/admin', component: 'Admin', protected: true },
      { path: '/dashboard', component: 'Dashboard', protected: true },
      { path: '/ranking', component: 'Ranking', protected: true },
      { path: '/novidades', component: 'Novidades', protected: false },
      { path: '/populares', component: 'Populares', protected: false },
      { path: '/premium', component: 'Premium', protected: false },
      { path: '/category/:categoryId', component: 'Category', protected: false },
      { path: '/state/:stateCode', component: 'State', protected: false }
    ];

    this.log('Verificando rotas definidas no App.jsx:\n');

    let routeProblemsFound = 0;
    
    for (const route of routesToCheck) {
      const routeExists = appContent.includes(`path="${route.path}"`) || 
                          appContent.includes(`path='${route.path}'`);
      const componentImported = appContent.includes(`import ${route.component}`) ||
                               appContent.includes(`const ${route.component} = lazy`);
      
      if (!routeExists) {
        routeProblemsFound++;
        this.addIssue(
          'ROTA_FALTANDO',
          'CR√çTICO',
          `Rota ${route.path} n√£o definida no App.jsx`,
          'src/App.jsx',
          `Adicionar rota: <Route path="${route.path}" element={<${route.component} />} />`
        );
        this.log(`‚ùå ROTA FALTANDO: ${route.path} -> ${route.component}`, 'red');
      } else if (!componentImported) {
        routeProblemsFound++;
        this.addIssue(
          'ROTA_IMPORT_FALTANDO',
          'CR√çTICO',
          `Componente ${route.component} n√£o importado no App.jsx`,
          'src/App.jsx',
          `Adicionar import: const ${route.component} = lazy(() => import('./pages/${route.component}'))`
        );
        this.log(`‚ùå IMPORT FALTANDO: ${route.component}`, 'red');
      } else {
        this.log(`‚úÖ OK: ${route.path} -> ${route.component}`, 'green');
      }
    }

    if (routeProblemsFound === 0) {
      this.log('\nüéâ TODAS AS ROTAS EST√ÉO CONFIGURADAS CORRETAMENTE!', 'green');
    } else {
      this.log(`\n‚ö†Ô∏è  ${routeProblemsFound} PROBLEMAS DE ROTA ENCONTRADOS!`, 'yellow');
    }
  }

  // 3. VERIFICAR SISTEMA DE VERIFICA√á√ÉO DE IDADE
  async checkAgeVerification() {
    this.logHeader('ANALISANDO SISTEMA DE VERIFICA√á√ÉO DE IDADE');

    const ageVerificationFile = 'src/components/AgeVerification.jsx';
    const homeFile = 'src/pages/Home.jsx';
    
    // Verificar se componente existe
    if (!this.fileExists(ageVerificationFile)) {
      this.addIssue(
        'IDADE_VERIFICACAO_FALTANDO',
        'CR√çTICO',
        'Componente AgeVerification.jsx n√£o encontrado',
        ageVerificationFile,
        'Criar componente AgeVerification.jsx para verifica√ß√£o de idade'
      );
      this.log('‚ùå AgeVerification.jsx N√ÉO ENCONTRADO!', 'red');
      return;
    }

    const ageContent = this.readFile(ageVerificationFile);
    const homeContent = this.readFile(homeFile);

    // Verificar problemas no sistema de verifica√ß√£o de idade
    let ageProblems = 0;

    // 1. Verificar se usa localStorage para persistir
    if (!ageContent.includes('localStorage') && !ageContent.includes('sessionStorage')) {
      ageProblems++;
      this.addIssue(
        'IDADE_PERSISTENCIA',
        'CR√çTICO',
        'Sistema de verifica√ß√£o de idade n√£o persiste - pedir√° verifica√ß√£o toda vez',
        ageVerificationFile,
        'Usar localStorage para salvar que usu√°rio j√° verificou idade: localStorage.setItem("ageVerified", "true")'
      );
      this.log('‚ùå IDADE N√ÉO PERSISTE - VAI PEDIR TODA VEZ!', 'red');
    }

    // 2. Verificar se Home.jsx verifica idade corretamente
    if (homeContent && !homeContent.includes('ageVerified') && !homeContent.includes('localStorage')) {
      ageProblems++;
      this.addIssue(
        'IDADE_HOME_VERIFICACAO',
        'CR√çTICO',
        'Home.jsx n√£o verifica se idade j√° foi confirmada',
        homeFile,
        'Verificar localStorage no Home.jsx antes de mostrar verifica√ß√£o de idade'
      );
      this.log('‚ùå HOME N√ÉO VERIFICA SE IDADE J√Å FOI CONFIRMADA!', 'red');
    }

    // 3. Verificar se outras p√°ginas limpam verifica√ß√£o
    const otherPages = ['Premium.jsx', 'Novidades.jsx', 'Populares.jsx'];
    for (const page of otherPages) {
      const pageContent = this.readFile(`src/pages/${page}`);
      if (pageContent && pageContent.includes('localStorage.removeItem')) {
        ageProblems++;
        this.addIssue(
          'IDADE_REMOVENDO_INDEVIDO',
          'M√âDIO',
          `P√°gina ${page} pode estar removendo verifica√ß√£o de idade`,
          `src/pages/${page}`,
          'N√£o remover localStorage da verifica√ß√£o de idade nas p√°ginas internas'
        );
        this.log(`‚ö†Ô∏è  ${page} pode estar removendo verifica√ß√£o de idade`, 'yellow');
      }
    }

    if (ageProblems === 0) {
      this.log('‚úÖ Sistema de verifica√ß√£o de idade parece OK', 'green');
    } else {
      this.log(`\n‚ö†Ô∏è  ${ageProblems} PROBLEMAS DE VERIFICA√á√ÉO DE IDADE ENCONTRADOS!`, 'yellow');
    }
  }

  // 4. VERIFICAR CONFIGURA√á√ÉO DO VITE
  async checkViteConfiguration() {
    this.logHeader('VERIFICANDO CONFIGURA√á√ÉO DO VITE');

    const viteConfigFile = 'vite.config.js';
    
    if (!this.fileExists(viteConfigFile)) {
      this.addIssue(
        'VITE_CONFIG_FALTANDO',
        'CR√çTICO',
        'vite.config.js n√£o encontrado',
        viteConfigFile,
        'Criar vite.config.js com configura√ß√µes de proxy e build'
      );
      this.log('‚ùå vite.config.js N√ÉO ENCONTRADO!', 'red');
      return;
    }

    const viteContent = this.readFile(viteConfigFile);
    let viteProblems = 0;

    // Verificar configura√ß√µes importantes
    if (!viteContent.includes('react()')) {
      viteProblems++;
      this.addIssue(
        'VITE_REACT_PLUGIN',
        'CR√çTICO',
        'Plugin React n√£o configurado no Vite',
        viteConfigFile,
        'Adicionar plugin: plugins: [react()]'
      );
      this.log('‚ùå Plugin React n√£o configurado!', 'red');
    }

    if (!viteContent.includes('proxy')) {
      viteProblems++;
      this.addIssue(
        'VITE_PROXY',
        'M√âDIO',
        'Proxy para API n√£o configurado',
        viteConfigFile,
        'Configurar proxy: proxy: { "/api": { target: "http://localhost:8080" } }'
      );
      this.log('‚ö†Ô∏è  Proxy para API n√£o configurado', 'yellow');
    }

    if (!viteContent.includes('build')) {
      viteProblems++;
      this.addIssue(
        'VITE_BUILD_CONFIG',
        'M√âDIO',
        'Configura√ß√µes de build n√£o otimizadas',
        viteConfigFile,
        'Adicionar configura√ß√µes de build para produ√ß√£o'
      );
      this.log('‚ö†Ô∏è  Configura√ß√µes de build n√£o otimizadas', 'yellow');
    }

    if (viteProblems === 0) {
      this.log('‚úÖ Configura√ß√£o do Vite parece OK', 'green');
    } else {
      this.log(`\n‚ö†Ô∏è  ${viteProblems} PROBLEMAS DE CONFIGURA√á√ÉO DO VITE!`, 'yellow');
    }
  }

  // 5. VERIFICAR CONFIGURA√á√ÉO DO PACKAGE.JSON
  async checkPackageJson() {
    this.logHeader('VERIFICANDO PACKAGE.JSON');

    const packageFile = 'package.json';
    
    if (!this.fileExists(packageFile)) {
      this.addIssue(
        'PACKAGE_JSON_FALTANDO',
        'CR√çTICO',
        'package.json n√£o encontrado',
        packageFile,
        'Criar package.json com todas as depend√™ncias necess√°rias'
      );
      this.log('‚ùå package.json N√ÉO ENCONTRADO!', 'red');
      return;
    }

    const packageContent = this.readFile(packageFile);
    const packageData = JSON.parse(packageContent);
    
    let packageProblems = 0;

    // Verificar type: module
    if (packageData.type !== 'module') {
      packageProblems++;
      this.addIssue(
        'PACKAGE_TYPE_MODULE',
        'CR√çTICO',
        'package.json n√£o est√° configurado para ES Modules',
        packageFile,
        'Adicionar: "type": "module" no package.json'
      );
      this.log('‚ùå N√£o est√° configurado para ES Modules!', 'red');
    }

    // Verificar scripts importantes
    const requiredScripts = ['dev', 'build', 'start', 'preview'];
    for (const script of requiredScripts) {
      if (!packageData.scripts || !packageData.scripts[script]) {
        packageProblems++;
        this.addIssue(
          'PACKAGE_SCRIPT_FALTANDO',
          'M√âDIO',
          `Script "${script}" n√£o encontrado no package.json`,
          packageFile,
          `Adicionar script "${script}" no package.json`
        );
        this.log(`‚ö†Ô∏è  Script "${script}" n√£o encontrado`, 'yellow');
      }
    }

    // Verificar depend√™ncias cr√≠ticas
    const requiredDeps = [
      'react', 'react-dom', 'react-router-dom', 
      'vite', '@vitejs/plugin-react',
      'axios', 'framer-motion'
    ];
    
    for (const dep of requiredDeps) {
      const hasInDeps = packageData.dependencies && packageData.dependencies[dep];
      const hasInDevDeps = packageData.devDependencies && packageData.devDependencies[dep];
      
      if (!hasInDeps && !hasInDevDeps) {
        packageProblems++;
        this.addIssue(
          'PACKAGE_DEP_FALTANDO',
          'CR√çTICO',
          `Depend√™ncia "${dep}" n√£o encontrada`,
          packageFile,
          `Instalar depend√™ncia: npm install ${dep}`
        );
        this.log(`‚ùå Depend√™ncia "${dep}" n√£o encontrada!`, 'red');
      }
    }

    if (packageProblems === 0) {
      this.log('‚úÖ package.json est√° configurado corretamente', 'green');
    } else {
      this.log(`\n‚ö†Ô∏è  ${packageProblems} PROBLEMAS NO PACKAGE.JSON!`, 'yellow');
    }
  }

  // 6. VERIFICAR PROBLEMA DO BCRYPT (do log de erro)
  async checkBcryptError() {
    this.logHeader('VERIFICANDO PROBLEMA DO BCRYPT (Deploy Error)');

    const serverFiles = [
      'server/index.js',
      'server/database.js',
      'package.json'
    ];

    let bcryptProblems = 0;

    // Verificar se arquivos do servidor existem
    for (const file of serverFiles) {
      if (!this.fileExists(file)) {
        bcryptProblems++;
        this.addIssue(
          'SERVER_FILE_FALTANDO',
          'CR√çTICO',
          `Arquivo do servidor n√£o encontrado: ${file}`,
          file,
          `Criar arquivo ${file} necess√°rio para o backend funcionar`
        );
        this.log(`‚ùå Arquivo do servidor faltando: ${file}`, 'red');
      }
    }

    // Verificar problema espec√≠fico do bcrypt
    const databaseContent = this.readFile('server/database.js');
    if (databaseContent) {
      if (databaseContent.includes('bcrypt.hash') && !databaseContent.includes('import bcrypt')) {
        bcryptProblems++;
        this.addIssue(
          'BCRYPT_IMPORT_ERROR',
          'CR√çTICO',
          'bcrypt n√£o est√° sendo importado corretamente no ES Modules',
          'server/database.js',
          'Corrigir import: import bcrypt from "bcryptjs" (ao inv√©s de bcrypt)'
        );
        this.log('‚ùå bcrypt n√£o importado corretamente - causando erro no deploy!', 'red');
      }

      if (databaseContent.includes('require(')) {
        bcryptProblems++;
        this.addIssue(
          'COMMONJS_IN_MODULES',
          'CR√çTICO',
          'Usando require() em ES Modules',
          'server/database.js',
          'Trocar require() por import em todos os arquivos do servidor'
        );
        this.log('‚ùå Usando require() em ES Modules!', 'red');
      }
    }

    if (bcryptProblems === 0) {
      this.log('‚úÖ Configura√ß√£o do servidor parece OK', 'green');
    } else {
      this.log(`\n‚ö†Ô∏è  ${bcryptProblems} PROBLEMAS DO SERVIDOR ENCONTRADOS!`, 'yellow');
    }
  }

  // ==================== RELAT√ìRIO FINAL ====================

  async generateReport() {
    this.logHeader('RELAT√ìRIO FINAL DE DIAGN√ìSTICO - PARTE 01');

    // Resumo dos problemas
    console.log(`${colors.bg.red}${colors.white} PROBLEMAS CR√çTICOS ENCONTRADOS: ${this.criticalIssues.length} ${colors.reset}`);
    console.log(`${colors.bg.yellow}${colors.white} TOTAL DE PROBLEMAS: ${this.issues.length} ${colors.reset}\n`);

    // Categorizar problemas
    const categories = {
      'ROTAS': this.issues.filter(i => i.category.includes('ROTA')),
      'VERIFICA√á√ÉO DE IDADE': this.issues.filter(i => i.category.includes('IDADE')),
      'ARQUIVOS FALTANDO': this.issues.filter(i => i.category.includes('ARQUIVO')),
      'CONFIGURA√á√ÉO': this.issues.filter(i => i.category.includes('VITE') || i.category.includes('PACKAGE')),
      'SERVIDOR/BCRYPT': this.issues.filter(i => i.category.includes('SERVER') || i.category.includes('BCRYPT'))
    };

    // Exibir problemas por categoria
    for (const [category, problems] of Object.entries(categories)) {
      if (problems.length > 0) {
        console.log(`${colors.cyan}${colors.bright}üìÇ ${category} (${problems.length} problemas):${colors.reset}`);
        
        problems.forEach((problem, index) => {
          const severity = problem.severity === 'CR√çTICO' ? 
            `${colors.bg.red}${colors.white} CR√çTICO ${colors.reset}` :
            `${colors.bg.yellow}${colors.white} M√âDIO ${colors.reset}`;
          
          console.log(`\n${index + 1}. ${severity}`);
          console.log(`   üìÑ Arquivo: ${colors.yellow}${problem.file}${colors.reset}`);
          console.log(`   üêõ Problema: ${problem.description}`);
          console.log(`   üí° Solu√ß√£o: ${colors.green}${problem.solution}${colors.reset}`);
        });
        console.log('');
      }
    }

    // Prioridades de corre√ß√£o
    console.log(`${colors.magenta}${colors.bright}üéØ PRIORIDADES DE CORRE√á√ÉO:${colors.reset}\n`);
    
    console.log(`${colors.red}1. CR√çTICO - Corrigir problemas de rotas${colors.reset}`);
    console.log(`   ‚Üí Verificar App.jsx e imports das p√°ginas`);
    console.log(`   ‚Üí Corrigir configura√ß√£o do Vite`);
    
    console.log(`\n${colors.yellow}2. IMPORTANTE - Sistema de verifica√ß√£o de idade${colors.reset}`);
    console.log(`   ‚Üí Implementar localStorage para persistir verifica√ß√£o`);
    console.log(`   ‚Üí Evitar verifica√ß√£o repetida entre p√°ginas`);
    
    console.log(`\n${colors.blue}3. SERVIDOR - Corrigir erro do bcrypt${colors.reset}`);
    console.log(`   ‚Üí Trocar require() por import`);
    console.log(`   ‚Üí Usar bcryptjs ao inv√©s de bcrypt`);

    // Arquivos para verificar/criar
    if (this.missingFiles.length > 0) {
      console.log(`\n${colors.cyan}${colors.bright}üìã ARQUIVOS PARA CRIAR/VERIFICAR:${colors.reset}`);
      this.missingFiles.forEach(file => {
        console.log(`   ‚Ä¢ ${file}`);
      });
    }

    console.log(`\n${colors.green}${colors.bright}‚ú® Ap√≥s corrigir estes problemas, suas rotas dever√£o funcionar!${colors.reset}`);
  }

  // ==================== EXECU√á√ÉO PRINCIPAL ====================

  async run() {
    console.clear();
    console.log(`${colors.magenta}${colors.bright}
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë              üîç DIAGN√ìSTICO PORTAL X BRASIL                  ‚ïë
‚ïë                    PARTE 01 - ROTAS                         ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
${colors.reset}`);

    try {
      await this.checkFileStructure();
      await this.checkRouteConfiguration();
      await this.checkAgeVerification();
      await this.checkViteConfiguration();
      await this.checkPackageJson();
      await this.checkBcryptError();
      await this.generateReport();
      
      console.log(`\n${colors.green}${colors.bright}üéâ DIAGN√ìSTICO CONCLU√çDO!${colors.reset}`);
      console.log(`${colors.cyan}Agora voc√™ tem um mapa completo dos problemas para corrigir.${colors.reset}\n`);
      
    } catch (error) {
      console.error(`${colors.red}‚ùå Erro durante diagn√≥stico: ${error.message}${colors.reset}`);
    }
  }
}

// Executar diagn√≥stico
const diagnostic = new PortalDiagnostic();
diagnostic.run();